{"ast":null,"code":"var _jsxFileName = \"/Users/batson24/Desktop/Date_Site/frontend/src/Routes/Room.js\";\nimport React, { useRef, useEffect } from 'react';\nimport io from 'socket.io-client';\n\nlet Room = props => {\n  let userVideo = useRef();\n  let partnerVideo = useRef();\n  let peerRef = useRef();\n  let socketRef = useRef();\n  let otherUser = useRef();\n  let userStream = useRef();\n  useEffect(() => {\n    navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: true\n    }).then(stream => {\n      userVideo.current.srcObject = stream;\n      userStream.current = stream;\n      socketRef.current = io.connect('/');\n      socketRef.current.emit('join room', props.match.params.roomID);\n      socketRef.current.on('other user', userID => {\n        callUser.current = userID;\n        otherUser.current = userID;\n      });\n      socketRef.current.on('user joined', userID => {\n        otherUser.current = userID;\n      });\n      socketRef.current.on('offer', handleRecieveCall);\n      socketRef.current.on('answer', handleAnswer);\n      socketRef.current.on('ice-candidate', handleNewICECandidateMsg);\n    });\n  }, []);\n\n  function callUser(userID) {\n    peerRef.current = createPeer(userID);\n    userStream.current.getTracks().forEach(track => peerRef.current.addTrack(track, userStream.current));\n  }\n\n  function createPeer(userID) {\n    let peer = new RTCPeerConnection({\n      iceServers: [{\n        urls: 'stun:stun.stunprotocol.org'\n      }, {\n        urls: 'trun:numb.viagenie.ca',\n        credential: 'muazkh',\n        username: 'webrtc@live.com'\n      }]\n    });\n    peer.onicecandidate = handleICECandidateEvent;\n    peer.ontrack = handleTrackEvent;\n\n    peer.onnegotiationneeded = () => handleNegotiationNeededEvent(userID);\n\n    return peer;\n  }\n\n  function handleNegotiationNeededEvent(userID) {\n    peerRef.current.createOffer().then(offer => {\n      return peerRef.current.setLocalDescription(offer);\n    }).then(() => {\n      let payload = {\n        target: userID,\n        caller: socketRef.current.id,\n        sdp: peerRef.current.localDecscription\n      };\n      socketRef.current.emit('offer', payload);\n    }).catch(e => console.log(e));\n  }\n\n  function handleRecieveCall(incoming) {\n    peerRef.current = createPeer();\n    let desc = new RTCSessionDescription(incoming.sdp);\n    peerRef.current.setRemoteDescription(desc).then(() => {\n      userStream.current.getTracks().forEach(track => peerRef.current.addTrack(track, userStream.current));\n    }).then(() => {\n      return peerRef.current.createAnswer();\n    }).then(answer => {\n      return peerRef.current.setLocalDescription(answer);\n    }).then(() => {\n      let payload = {\n        target: incoming.caller,\n        caller: socketRef.current.id,\n        sdp: peerRef.current.localDescription\n      };\n      socketRef.current.emit('answer', payload);\n    });\n  }\n\n  function handleAnswer(message) {\n    let desc = new RTCSessionDescription(message.sdp);\n    peerRef.current.setRemoteDescription(desc).catch(e => console.log(e));\n  }\n\n  function handleICECandidateEvent(e) {\n    if (e.candidate) {\n      let payload = {\n        target: otherUser.current,\n        candidate: e.candidate\n      };\n      socketRef.current.emit('ice-candidate', payload);\n    }\n  }\n\n  function handleNewICECandidateMsg(incoming) {\n    let candidate = new RTCIceCandidate(incoming);\n    peerRef.current.addIceCandidate(candidate).catch(e => console.log(e));\n  }\n\n  function handleTrackEvent(e) {\n    partnerVideo.current.srcObject = e.streams[0];\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    autoPlay: true,\n    ref: userVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"video\", {\n    autoPlay: true,\n    ref: partnerVideo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 13\n    }\n  }));\n};\n\nexport default Room;","map":{"version":3,"sources":["/Users/batson24/Desktop/Date_Site/frontend/src/Routes/Room.js"],"names":["React","useRef","useEffect","io","Room","props","userVideo","partnerVideo","peerRef","socketRef","otherUser","userStream","navigator","mediaDevices","getUserMedia","audio","video","then","stream","current","srcObject","connect","emit","match","params","roomID","on","userID","callUser","handleRecieveCall","handleAnswer","handleNewICECandidateMsg","createPeer","getTracks","forEach","track","addTrack","peer","RTCPeerConnection","iceServers","urls","credential","username","onicecandidate","handleICECandidateEvent","ontrack","handleTrackEvent","onnegotiationneeded","handleNegotiationNeededEvent","createOffer","offer","setLocalDescription","payload","target","caller","id","sdp","localDecscription","catch","e","console","log","incoming","desc","RTCSessionDescription","setRemoteDescription","createAnswer","answer","localDescription","message","candidate","RTCIceCandidate","addIceCandidate","streams"],"mappings":";AAAA,OAAOA,KAAP,IAAeC,MAAf,EAAuBC,SAAvB,QAAuC,OAAvC;AACA,OAAOC,EAAP,MAAe,kBAAf;;AAEA,IAAIC,IAAI,GAAIC,KAAD,IAAS;AAChB,MAAIC,SAAS,GAACL,MAAM,EAApB;AACA,MAAIM,YAAY,GAAGN,MAAM,EAAzB;AACA,MAAIO,OAAO,GAAGP,MAAM,EAApB;AACA,MAAIQ,SAAS,GAAER,MAAM,EAArB;AACA,MAAIS,SAAS,GAAET,MAAM,EAArB;AACA,MAAIU,UAAU,GAAEV,MAAM,EAAtB;AAEAC,EAAAA,SAAS,CAAC,MAAK;AACXU,IAAAA,SAAS,CAACC,YAAV,CAAuBC,YAAvB,CAAoC;AAACC,MAAAA,KAAK,EAAC,IAAP;AAAaC,MAAAA,KAAK,EAAC;AAAnB,KAApC,EAA8DC,IAA9D,CAAmEC,MAAM,IAAE;AACvEZ,MAAAA,SAAS,CAACa,OAAV,CAAkBC,SAAlB,GAA4BF,MAA5B;AACAP,MAAAA,UAAU,CAACQ,OAAX,GAAmBD,MAAnB;AAEAT,MAAAA,SAAS,CAACU,OAAV,GAAoBhB,EAAE,CAACkB,OAAH,CAAW,GAAX,CAApB;AACAZ,MAAAA,SAAS,CAACU,OAAV,CAAkBG,IAAlB,CAAuB,WAAvB,EAAoCjB,KAAK,CAACkB,KAAN,CAAYC,MAAZ,CAAmBC,MAAvD;AACAhB,MAAAA,SAAS,CAACU,OAAV,CAAkBO,EAAlB,CAAqB,YAArB,EAAmCC,MAAM,IAAE;AACvCC,QAAAA,QAAQ,CAACT,OAAT,GAAiBQ,MAAjB;AACAjB,QAAAA,SAAS,CAACS,OAAV,GAAkBQ,MAAlB;AACH,OAHD;AAKJlB,MAAAA,SAAS,CAACU,OAAV,CAAkBO,EAAlB,CAAqB,aAArB,EAAoCC,MAAM,IAAE;AACxCjB,QAAAA,SAAS,CAACS,OAAV,GAAkBQ,MAAlB;AACH,OAFD;AAGAlB,MAAAA,SAAS,CAACU,OAAV,CAAkBO,EAAlB,CAAqB,OAArB,EAA6BG,iBAA7B;AACApB,MAAAA,SAAS,CAACU,OAAV,CAAkBO,EAAlB,CAAqB,QAArB,EAA+BI,YAA/B;AACArB,MAAAA,SAAS,CAACU,OAAV,CAAkBO,EAAlB,CAAqB,eAArB,EAAsCK,wBAAtC;AACH,KAjBG;AAkBH,GAnBQ,EAmBP,EAnBO,CAAT;;AAqBA,WAASH,QAAT,CAAkBD,MAAlB,EAAyB;AACrBnB,IAAAA,OAAO,CAACW,OAAR,GAAgBa,UAAU,CAACL,MAAD,CAA1B;AACAhB,IAAAA,UAAU,CAACQ,OAAX,CAAmBc,SAAnB,GAA+BC,OAA/B,CAAuCC,KAAK,IAAI3B,OAAO,CAACW,OAAR,CAAgBiB,QAAhB,CAAyBD,KAAzB,EAA+BxB,UAAU,CAACQ,OAA1C,CAAhD;AACH;;AAED,WAASa,UAAT,CAAoBL,MAApB,EAA2B;AACvB,QAAIU,IAAI,GAAE,IAAIC,iBAAJ,CAAsB;AAC5BC,MAAAA,UAAU,EAAC,CACP;AACIC,QAAAA,IAAI,EAAC;AADT,OADO,EAIP;AACIA,QAAAA,IAAI,EAAE,uBADV;AAEIC,QAAAA,UAAU,EAAE,QAFhB;AAGIC,QAAAA,QAAQ,EAAE;AAHd,OAJO;AADiB,KAAtB,CAAV;AAYAL,IAAAA,IAAI,CAACM,cAAL,GAAqBC,uBAArB;AACAP,IAAAA,IAAI,CAACQ,OAAL,GAAaC,gBAAb;;AACAT,IAAAA,IAAI,CAACU,mBAAL,GAA0B,MAAKC,4BAA4B,CAACrB,MAAD,CAA3D;;AACA,WAAOU,IAAP;AACH;;AACD,WAASW,4BAAT,CAAsCrB,MAAtC,EAA6C;AACzCnB,IAAAA,OAAO,CAACW,OAAR,CAAgB8B,WAAhB,GAA8BhC,IAA9B,CAAmCiC,KAAK,IAAE;AACtC,aAAO1C,OAAO,CAACW,OAAR,CAAgBgC,mBAAhB,CAAoCD,KAApC,CAAP;AACH,KAFD,EAEGjC,IAFH,CAEQ,MAAI;AACJ,UAAImC,OAAO,GAAC;AACRC,QAAAA,MAAM,EAAC1B,MADC;AAER2B,QAAAA,MAAM,EAAE7C,SAAS,CAACU,OAAV,CAAkBoC,EAFlB;AAGRC,QAAAA,GAAG,EAAChD,OAAO,CAACW,OAAR,CAAgBsC;AAHZ,OAAZ;AAKAhD,MAAAA,SAAS,CAACU,OAAV,CAAkBG,IAAlB,CAAuB,OAAvB,EAAgC8B,OAAhC;AACH,KATL,EASOM,KATP,CASaC,CAAC,IAAGC,OAAO,CAACC,GAAR,CAAYF,CAAZ,CATjB;AAUC;;AACD,WAAS9B,iBAAT,CAA2BiC,QAA3B,EAAoC;AAChCtD,IAAAA,OAAO,CAACW,OAAR,GAAkBa,UAAU,EAA5B;AACA,QAAI+B,IAAI,GAAG,IAAIC,qBAAJ,CAA0BF,QAAQ,CAACN,GAAnC,CAAX;AACAhD,IAAAA,OAAO,CAACW,OAAR,CAAgB8C,oBAAhB,CAAqCF,IAArC,EAA2C9C,IAA3C,CAAgD,MAAI;AAChDN,MAAAA,UAAU,CAACQ,OAAX,CAAmBc,SAAnB,GAA+BC,OAA/B,CAAuCC,KAAK,IAAG3B,OAAO,CAACW,OAAR,CAAgBiB,QAAhB,CAAyBD,KAAzB,EAAgCxB,UAAU,CAACQ,OAA3C,CAA/C;AACH,KAFD,EAEGF,IAFH,CAEQ,MAAK;AACT,aAAOT,OAAO,CAACW,OAAR,CAAgB+C,YAAhB,EAAP;AACH,KAJD,EAIGjD,IAJH,CAIQkD,MAAM,IAAE;AACZ,aAAO3D,OAAO,CAACW,OAAR,CAAgBgC,mBAAhB,CAAoCgB,MAApC,CAAP;AACH,KAND,EAMGlD,IANH,CAMQ,MAAI;AACR,UAAImC,OAAO,GAAC;AACRC,QAAAA,MAAM,EAAES,QAAQ,CAACR,MADT;AAERA,QAAAA,MAAM,EAAE7C,SAAS,CAACU,OAAV,CAAkBoC,EAFlB;AAGRC,QAAAA,GAAG,EAAChD,OAAO,CAACW,OAAR,CAAgBiD;AAHZ,OAAZ;AAKA3D,MAAAA,SAAS,CAACU,OAAV,CAAkBG,IAAlB,CAAuB,QAAvB,EAAiC8B,OAAjC;AAEH,KAdD;AAiBH;;AACD,WAAStB,YAAT,CAAsBuC,OAAtB,EAA8B;AAC1B,QAAIN,IAAI,GAAE,IAAIC,qBAAJ,CAA0BK,OAAO,CAACb,GAAlC,CAAV;AACAhD,IAAAA,OAAO,CAACW,OAAR,CAAgB8C,oBAAhB,CAAqCF,IAArC,EAA2CL,KAA3C,CAAiDC,CAAC,IAAEC,OAAO,CAACC,GAAR,CAAYF,CAAZ,CAApD;AACH;;AAED,WAASf,uBAAT,CAAiCe,CAAjC,EAAmC;AAC/B,QAAGA,CAAC,CAACW,SAAL,EAAe;AACX,UAAIlB,OAAO,GAAC;AACRC,QAAAA,MAAM,EAAE3C,SAAS,CAACS,OADV;AAERmD,QAAAA,SAAS,EAAEX,CAAC,CAACW;AAFL,OAAZ;AAIA7D,MAAAA,SAAS,CAACU,OAAV,CAAkBG,IAAlB,CAAuB,eAAvB,EAAuC8B,OAAvC;AACH;AACJ;;AAED,WAASrB,wBAAT,CAAkC+B,QAAlC,EAA2C;AACvC,QAAIQ,SAAS,GAAC,IAAIC,eAAJ,CAAoBT,QAApB,CAAd;AACAtD,IAAAA,OAAO,CAACW,OAAR,CAAgBqD,eAAhB,CAAgCF,SAAhC,EACCZ,KADD,CACOC,CAAC,IAAGC,OAAO,CAACC,GAAR,CAAYF,CAAZ,CADX;AAEH;;AAEF,WAASb,gBAAT,CAA0Ba,CAA1B,EAA4B;AACxBpD,IAAAA,YAAY,CAACY,OAAb,CAAqBC,SAArB,GAA+BuC,CAAC,CAACc,OAAF,CAAU,CAAV,CAA/B;AACH;;AAGJ,sBACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAO,IAAA,QAAQ,MAAf;AAAgB,IAAA,GAAG,EAAEnE,SAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,eAEI;AAAO,IAAA,QAAQ,MAAf;AAAgB,IAAA,GAAG,EAAEC,YAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFJ,CADJ;AAOH,CAtHD;;AAwHA,eAAeH,IAAf","sourcesContent":["import React, {useRef, useEffect} from 'react'\nimport io from 'socket.io-client'\n\nlet Room = (props)=>{\n    let userVideo=useRef()\n    let partnerVideo = useRef()\n    let peerRef = useRef()\n    let socketRef= useRef()\n    let otherUser= useRef()\n    let userStream= useRef()\n\n    useEffect(() =>{\n        navigator.mediaDevices.getUserMedia({audio:true, video:true}).then(stream=>{\n            userVideo.current.srcObject=stream\n            userStream.current=stream\n\n            socketRef.current = io.connect('/')\n            socketRef.current.emit('join room', props.match.params.roomID)\n            socketRef.current.on('other user', userID=>{\n                callUser.current=userID;\n                otherUser.current=userID\n            })\n        \n        socketRef.current.on('user joined', userID=>{\n            otherUser.current=userID;\n        })\n        socketRef.current.on('offer',handleRecieveCall)\n        socketRef.current.on('answer', handleAnswer)\n        socketRef.current.on('ice-candidate', handleNewICECandidateMsg)\n    })\n    },[])\n\n    function callUser(userID){\n        peerRef.current=createPeer(userID)\n        userStream.current.getTracks().forEach(track => peerRef.current.addTrack(track,userStream.current))\n    }\n\n    function createPeer(userID){\n        let peer= new RTCPeerConnection({\n            iceServers:[\n                {\n                    urls:'stun:stun.stunprotocol.org'\n                },\n                {\n                    urls: 'trun:numb.viagenie.ca',\n                    credential: 'muazkh',\n                    username: 'webrtc@live.com'\n                }\n            ]\n        })\n        peer.onicecandidate= handleICECandidateEvent\n        peer.ontrack=handleTrackEvent\n        peer.onnegotiationneeded= ()=> handleNegotiationNeededEvent(userID)\n        return peer\n    }\n    function handleNegotiationNeededEvent(userID){\n        peerRef.current.createOffer().then(offer=>{\n            return peerRef.current.setLocalDescription(offer)\n        }).then(()=>{\n                let payload={\n                    target:userID,\n                    caller: socketRef.current.id,\n                    sdp:peerRef.current.localDecscription\n                }\n                socketRef.current.emit('offer', payload)\n            }).catch(e=> console.log(e))\n        }\n        function handleRecieveCall(incoming){\n            peerRef.current = createPeer()\n            let desc = new RTCSessionDescription(incoming.sdp)\n            peerRef.current.setRemoteDescription(desc).then(()=>{\n                userStream.current.getTracks().forEach(track=> peerRef.current.addTrack(track, userStream.current))\n            }).then(() =>{\n                return peerRef.current.createAnswer()\n            }).then(answer=>{\n                return peerRef.current.setLocalDescription(answer)\n            }).then(()=>{\n                let payload={\n                    target: incoming.caller,\n                    caller: socketRef.current.id,\n                    sdp:peerRef.current.localDescription\n                }\n                socketRef.current.emit('answer', payload)\n            \n            })\n            \n            \n        }\n        function handleAnswer(message){\n            let desc= new RTCSessionDescription(message.sdp)\n            peerRef.current.setRemoteDescription(desc).catch(e=>console.log(e))\n        }\n\n        function handleICECandidateEvent(e){\n            if(e.candidate){\n                let payload={\n                    target: otherUser.current,\n                    candidate: e.candidate,\n                }\n                socketRef.current.emit('ice-candidate',payload)\n            }\n        }\n\n        function handleNewICECandidateMsg(incoming){\n            let candidate=new RTCIceCandidate(incoming)\n            peerRef.current.addIceCandidate(candidate)\n            .catch(e=> console.log(e))\n        }\n            \n       function handleTrackEvent(e){\n           partnerVideo.current.srcObject=e.streams[0]\n       }\n    \n\n    return(\n        <div>\n            <video autoPlay ref={userVideo}/>\n            <video autoPlay ref={partnerVideo}/>\n        </div>\n\n    )\n}\n\nexport default Room"]},"metadata":{},"sourceType":"module"}