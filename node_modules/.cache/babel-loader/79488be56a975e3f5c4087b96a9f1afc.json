{"ast":null,"code":"// Browser Request\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nvar XHR = XMLHttpRequest;\nif (!XHR) throw new Error('missing XMLHttpRequest');\nrequest.log = {\n  'trace': noop,\n  'debug': noop,\n  'info': noop,\n  'warn': noop,\n  'error': noop\n};\nvar DEFAULT_TIMEOUT = 3 * 60 * 1000; // 3 minutes\n//\n// PolyFill\n// \n// Production steps of ECMA-262, Edition 5, 15.4.4.18\n// Reference: http://es5.github.io/#x15.4.4.18\n\nif (!Array.prototype.forEach) {\n  Array.prototype.forEach = function (callback, thisArg) {\n    var T, k;\n\n    if (this === null) {\n      throw new TypeError(' this is null or not defined');\n    } // 1. Let O be the result of calling toObject() passing the\n    // |this| value as the argument.\n\n\n    var O = Object(this); // 2. Let lenValue be the result of calling the Get() internal\n    // method of O with the argument \"length\".\n    // 3. Let len be toUint32(lenValue).\n\n    var len = O.length >>> 0; // 4. If isCallable(callback) is false, throw a TypeError exception. \n    // See: http://es5.github.com/#x9.11\n\n    if (typeof callback !== \"function\") {\n      throw new TypeError(callback + ' is not a function');\n    } // 5. If thisArg was supplied, let T be thisArg; else let\n    // T be undefined.\n\n\n    if (arguments.length > 1) {\n      T = thisArg;\n    } // 6. Let k be 0\n\n\n    k = 0; // 7. Repeat, while k < len\n\n    while (k < len) {\n      var kValue; // a. Let Pk be ToString(k).\n      //    This is implicit for LHS operands of the in operator\n      // b. Let kPresent be the result of calling the HasProperty\n      //    internal method of O with argument Pk.\n      //    This step can be combined with c\n      // c. If kPresent is true, then\n\n      if (k in O) {\n        // i. Let kValue be the result of calling the Get internal\n        // method of O with argument Pk.\n        kValue = O[k]; // ii. Call the Call internal method of callback with T as\n        // the this value and argument list containing kValue, k, and O.\n\n        callback.call(T, kValue, k, O);\n      } // d. Increase k by 1.\n\n\n      k++;\n    } // 8. return undefined\n\n  };\n} //\n// request\n//\n\n\nfunction request(options, callback) {\n  // The entry-point to the API: prep the options object and pass the real work to run_xhr.\n  if (typeof callback !== 'function') throw new Error('Bad callback given: ' + callback);\n  if (!options) throw new Error('No options given');\n  var options_onResponse = options.onResponse; // Save this for later.\n\n  if (typeof options === 'string') options = {\n    'uri': options\n  };else options = JSON.parse(JSON.stringify(options)); // Use a duplicate for mutating.\n\n  options.onResponse = options_onResponse; // And put it back.\n\n  if (options.verbose) request.log = getLogger();\n\n  if (options.url) {\n    options.uri = options.url;\n    delete options.url;\n  }\n\n  if (!options.uri && options.uri !== \"\") throw new Error(\"options.uri is a required argument\");\n  if (typeof options.uri != \"string\") throw new Error(\"options.uri must be a string\");\n  var unsupported_options = ['proxy', '_redirectsFollowed', 'maxRedirects', 'followRedirect'];\n\n  for (var i = 0; i < unsupported_options.length; i++) if (options[unsupported_options[i]]) throw new Error(\"options.\" + unsupported_options[i] + \" is not supported\");\n\n  options.callback = callback;\n  options.method = options.method || 'GET';\n  options.headers = options.headers || {};\n  options.body = options.body || null;\n  options.timeout = options.timeout || request.DEFAULT_TIMEOUT;\n  if (options.headers.host) throw new Error(\"Options.headers.host is not supported\");\n\n  if (options.json) {\n    options.headers.accept = options.headers.accept || 'application/json';\n    if (options.method !== 'GET') options.headers['content-type'] = 'application/json';\n    if (typeof options.json !== 'boolean') options.body = JSON.stringify(options.json);else if (typeof options.body !== 'string' && options.body !== null) options.body = JSON.stringify(options.body);\n  } //BEGIN QS Hack\n\n\n  var serialize = function (obj) {\n    var str = [];\n\n    for (var p in obj) if (obj.hasOwnProperty(p)) {\n      str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\n    }\n\n    return str.join(\"&\");\n  };\n\n  if (options.qs) {\n    var qs = typeof options.qs == 'string' ? options.qs : serialize(options.qs);\n\n    if (options.uri.indexOf('?') !== -1) {\n      //no get params\n      options.uri = options.uri + '&' + qs;\n    } else {\n      //existing get params\n      options.uri = options.uri + '?' + qs;\n    }\n  } //END QS Hack\n  //BEGIN FORM Hack\n\n\n  var multipart = function (obj) {\n    //todo: support file type (useful?)\n    var result = {};\n    result.boundry = '-------------------------------' + Math.floor(Math.random() * 1000000000);\n    var lines = [];\n\n    for (var p in obj) {\n      if (obj.hasOwnProperty(p)) {\n        lines.push('--' + result.boundry + \"\\n\" + 'Content-Disposition: form-data; name=\"' + p + '\"' + \"\\n\" + \"\\n\" + obj[p] + \"\\n\");\n      }\n    }\n\n    lines.push('--' + result.boundry + '--');\n    result.body = lines.join('');\n    result.length = result.body.length;\n    result.type = 'multipart/form-data; boundary=' + result.boundry;\n    return result;\n  };\n\n  if (options.form) {\n    if (typeof options.form == 'string') throw 'form name unsupported';\n\n    if (options.method === 'POST') {\n      var encoding = (options.encoding || 'application/x-www-form-urlencoded').toLowerCase();\n      options.headers['content-type'] = encoding;\n\n      switch (encoding) {\n        case 'application/x-www-form-urlencoded':\n          options.body = serialize(options.form).replace(/%20/g, \"+\");\n          break;\n\n        case 'multipart/form-data':\n          var multi = multipart(options.form); //options.headers['content-length'] = multi.length;\n\n          options.body = multi.body;\n          options.headers['content-type'] = multi.type;\n          break;\n\n        default:\n          throw new Error('unsupported encoding:' + encoding);\n      }\n    }\n  } //END FORM Hack\n  // If onResponse is boolean true, call back immediately when the response is known,\n  // not when the full request is complete.\n\n\n  options.onResponse = options.onResponse || noop;\n\n  if (options.onResponse === true) {\n    options.onResponse = callback;\n    options.callback = noop;\n  } // XXX Browsers do not like this.\n  //if(options.body)\n  //  options.headers['content-length'] = options.body.length;\n  // HTTP basic authentication\n\n\n  if (!options.headers.authorization && options.auth) options.headers.authorization = 'Basic ' + b64_enc(options.auth.username + ':' + options.auth.password);\n  return run_xhr(options);\n}\n\nvar req_seq = 0;\n\nfunction run_xhr(options) {\n  var xhr = new XHR(),\n      timed_out = false,\n      is_cors = is_crossDomain(options.uri),\n      supports_cors = ('withCredentials' in xhr);\n  req_seq += 1;\n  xhr.seq_id = req_seq;\n  xhr.id = req_seq + ': ' + options.method + ' ' + options.uri;\n  xhr._id = xhr.id; // I know I will type \"_id\" from habit all the time.\n\n  if (is_cors && !supports_cors) {\n    var cors_err = new Error('Browser does not support cross-origin request: ' + options.uri);\n    cors_err.cors = 'unsupported';\n    return options.callback(cors_err, xhr);\n  }\n\n  xhr.timeoutTimer = setTimeout(too_late, options.timeout);\n\n  function too_late() {\n    timed_out = true;\n    var er = new Error('ETIMEDOUT');\n    er.code = 'ETIMEDOUT';\n    er.duration = options.timeout;\n    request.log.error('Timeout', {\n      'id': xhr._id,\n      'milliseconds': options.timeout\n    });\n    return options.callback(er, xhr);\n  } // Some states can be skipped over, so remember what is still incomplete.\n\n\n  var did = {\n    'response': false,\n    'loading': false,\n    'end': false\n  };\n  xhr.onreadystatechange = on_state_change;\n  xhr.open(options.method, options.uri, true); // asynchronous\n\n  if (is_cors) xhr.withCredentials = !!options.withCredentials;\n\n  for (var key in options.headers) xhr.setRequestHeader(key, options.headers[key]);\n\n  xhr.send(options.body);\n  return xhr;\n\n  function on_state_change(event) {\n    if (timed_out) return request.log.debug('Ignoring timed out state change', {\n      'state': xhr.readyState,\n      'id': xhr.id\n    });\n    request.log.debug('State change', {\n      'state': xhr.readyState,\n      'id': xhr.id,\n      'timed_out': timed_out\n    });\n\n    if (xhr.readyState === 1) {\n      request.log.debug('Request started', {\n        'id': xhr.id\n      });\n    } else if (xhr.readyState === 2) on_response();else if (xhr.readyState === 3) {\n      on_response();\n      on_loading();\n    } else if (xhr.readyState === 4) {\n      on_response();\n      on_loading();\n      on_end();\n    }\n  }\n\n  function on_response() {\n    if (did.response) return;\n    did.response = true;\n    request.log.debug('Got response', {\n      'id': xhr.id,\n      'status': xhr.status\n    });\n    clearTimeout(xhr.timeoutTimer);\n    xhr.statusCode = xhr.status; // Node request compatibility\n    // Detect failed CORS requests.\n\n    if (is_cors && xhr.statusCode == 0) {\n      var cors_err = new Error('CORS request rejected: ' + options.uri);\n      cors_err.cors = 'rejected'; // Do not process this request further.\n\n      did.loading = true;\n      did.end = true;\n      return options.callback(cors_err, xhr);\n    }\n\n    options.onResponse(null, xhr);\n  }\n\n  function on_loading() {\n    if (did.loading) return;\n    did.loading = true;\n    request.log.debug('Response body loading', {\n      'id': xhr.id\n    }); // TODO: Maybe simulate \"data\" events by watching xhr.responseText\n  }\n\n  function on_end() {\n    if (did.end) return;\n    did.end = true;\n    request.log.debug('Request done', {\n      'id': xhr.id\n    });\n    xhr.body = xhr.responseText;\n\n    if (options.json) {\n      try {\n        xhr.body = JSON.parse(xhr.responseText);\n      } catch (er) {\n        return options.callback(er, xhr);\n      }\n    }\n\n    options.callback(null, xhr, xhr.body);\n  }\n} // request\n\n\nrequest.withCredentials = false;\nrequest.DEFAULT_TIMEOUT = DEFAULT_TIMEOUT; //\n// defaults\n//\n\nrequest.defaults = function (options, requester) {\n  var def = function (method) {\n    var d = function (params, callback) {\n      if (typeof params === 'string') params = {\n        'uri': params\n      };else {\n        params = JSON.parse(JSON.stringify(params));\n      }\n\n      for (var i in options) {\n        if (params[i] === undefined) params[i] = options[i];\n      }\n\n      return method(params, callback);\n    };\n\n    return d;\n  };\n\n  var de = def(request);\n  de.get = def(request.get);\n  de.post = def(request.post);\n  de.put = def(request.put);\n  de.head = def(request.head);\n  return de;\n}; //\n// HTTP method shortcuts\n//\n\n\nvar shortcuts = ['get', 'put', 'post', 'head'];\nshortcuts.forEach(function (shortcut) {\n  var method = shortcut.toUpperCase();\n  var func = shortcut.toLowerCase();\n\n  request[func] = function (opts) {\n    if (typeof opts === 'string') opts = {\n      'method': method,\n      'uri': opts\n    };else {\n      opts = JSON.parse(JSON.stringify(opts));\n      opts.method = method;\n    }\n    var args = [opts].concat(Array.prototype.slice.apply(arguments, [1]));\n    return request.apply(this, args);\n  };\n}); //\n// CouchDB shortcut\n//\n\nrequest.couch = function (options, callback) {\n  if (typeof options === 'string') options = {\n    'uri': options\n  }; // Just use the request API to do JSON.\n\n  options.json = true;\n  if (options.body) options.json = options.body;\n  delete options.body;\n  callback = callback || noop;\n  var xhr = request(options, couch_handler);\n  return xhr;\n\n  function couch_handler(er, resp, body) {\n    if (er) return callback(er, resp, body);\n\n    if ((resp.statusCode < 200 || resp.statusCode > 299) && body.error) {\n      // The body is a Couch JSON object indicating the error.\n      er = new Error('CouchDB error: ' + (body.error.reason || body.error.error));\n\n      for (var key in body) er[key] = body[key];\n\n      return callback(er, resp, body);\n    }\n\n    return callback(er, resp, body);\n  }\n}; //\n// Utility\n//\n\n\nfunction noop() {}\n\nfunction getLogger() {\n  var logger = {},\n      levels = ['trace', 'debug', 'info', 'warn', 'error'],\n      level,\n      i;\n\n  for (i = 0; i < levels.length; i++) {\n    level = levels[i];\n    logger[level] = noop;\n    if (typeof console !== 'undefined' && console && console[level]) logger[level] = formatted(console, level);\n  }\n\n  return logger;\n}\n\nfunction formatted(obj, method) {\n  return formatted_logger;\n\n  function formatted_logger(str, context) {\n    if (typeof context === 'object') str += ' ' + JSON.stringify(context);\n    return obj[method].call(obj, str);\n  }\n} // Return whether a URL is a cross-domain request.\n\n\nfunction is_crossDomain(url) {\n  // Fix for React Native. CORS does noet exist in that environment\n  if (navigator && navigator.product === 'ReactNative') {\n    return false;\n  }\n\n  var rurl = /^([\\w\\+\\.\\-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+))?)?/; // jQuery #8138, IE may throw an exception when accessing\n  // a field from window.location if document.domain has been set\n\n  var ajaxLocation;\n\n  try {\n    ajaxLocation = location.href;\n  } catch (e) {\n    // Use the href attribute of an A element since IE will modify it given document.location\n    ajaxLocation = document.createElement(\"a\");\n    ajaxLocation.href = \"\";\n    ajaxLocation = ajaxLocation.href;\n  }\n\n  var ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || [],\n      parts = rurl.exec(url.toLowerCase());\n  var result = !!(parts && (parts[1] != ajaxLocParts[1] || parts[2] != ajaxLocParts[2] || (parts[3] || (parts[1] === \"http:\" ? 80 : 443)) != (ajaxLocParts[3] || (ajaxLocParts[1] === \"http:\" ? 80 : 443)))); //console.debug('is_crossDomain('+url+') -> ' + result)\n\n  return result;\n} // MIT License from http://phpjs.org/functions/base64_encode:358\n\n\nfunction b64_enc(data) {\n  // Encodes string using MIME base64 algorithm\n  var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n  var o1,\n      o2,\n      o3,\n      h1,\n      h2,\n      h3,\n      h4,\n      bits,\n      i = 0,\n      ac = 0,\n      enc = \"\",\n      tmp_arr = [];\n\n  if (!data) {\n    return data;\n  } // assume utf8 data\n  // data = this.utf8_encode(data+'');\n\n\n  do {\n    // pack three octets into four hexets\n    o1 = data.charCodeAt(i++);\n    o2 = data.charCodeAt(i++);\n    o3 = data.charCodeAt(i++);\n    bits = o1 << 16 | o2 << 8 | o3;\n    h1 = bits >> 18 & 0x3f;\n    h2 = bits >> 12 & 0x3f;\n    h3 = bits >> 6 & 0x3f;\n    h4 = bits & 0x3f; // use hexets to index into b64, and append result to encoded string\n\n    tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n  } while (i < data.length);\n\n  enc = tmp_arr.join('');\n\n  switch (data.length % 3) {\n    case 1:\n      enc = enc.slice(0, -2) + '==';\n      break;\n\n    case 2:\n      enc = enc.slice(0, -1) + '=';\n      break;\n  }\n\n  return enc;\n}\n\nmodule.exports = request;","map":{"version":3,"sources":["/Users/batson24/Desktop/Date_Site/frontend/node_modules/@stream-io/xmlhttp-request/index.js"],"names":["XHR","XMLHttpRequest","Error","request","log","noop","DEFAULT_TIMEOUT","Array","prototype","forEach","callback","thisArg","T","k","TypeError","O","Object","len","length","arguments","kValue","call","options","options_onResponse","onResponse","JSON","parse","stringify","verbose","getLogger","url","uri","unsupported_options","i","method","headers","body","timeout","host","json","accept","serialize","obj","str","p","hasOwnProperty","push","encodeURIComponent","join","qs","indexOf","multipart","result","boundry","Math","floor","random","lines","type","form","encoding","toLowerCase","replace","multi","authorization","auth","b64_enc","username","password","run_xhr","req_seq","xhr","timed_out","is_cors","is_crossDomain","supports_cors","seq_id","id","_id","cors_err","cors","timeoutTimer","setTimeout","too_late","er","code","duration","error","did","onreadystatechange","on_state_change","open","withCredentials","key","setRequestHeader","send","event","debug","readyState","on_response","on_loading","on_end","response","status","clearTimeout","statusCode","loading","end","responseText","defaults","requester","def","d","params","undefined","de","get","post","put","head","shortcuts","shortcut","toUpperCase","func","opts","args","concat","slice","apply","couch","couch_handler","resp","reason","logger","levels","level","console","formatted","formatted_logger","context","navigator","product","rurl","ajaxLocation","location","href","e","document","createElement","ajaxLocParts","exec","parts","data","b64","o1","o2","o3","h1","h2","h3","h4","bits","ac","enc","tmp_arr","charCodeAt","charAt","module","exports"],"mappings":"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","sourcesContent":["// Browser Request\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nvar XHR = XMLHttpRequest\nif (!XHR) throw new Error('missing XMLHttpRequest')\nrequest.log = {\n  'trace': noop, 'debug': noop, 'info': noop, 'warn': noop, 'error': noop\n}\n\nvar DEFAULT_TIMEOUT = 3 * 60 * 1000 // 3 minutes\n\n//\n// PolyFill\n// \n\n// Production steps of ECMA-262, Edition 5, 15.4.4.18\n// Reference: http://es5.github.io/#x15.4.4.18\nif (!Array.prototype.forEach) {\n\n  Array.prototype.forEach = function(callback, thisArg) {\n\n    var T, k;\n\n    if (this === null) {\n      throw new TypeError(' this is null or not defined');\n    }\n\n    // 1. Let O be the result of calling toObject() passing the\n    // |this| value as the argument.\n    var O = Object(this);\n\n    // 2. Let lenValue be the result of calling the Get() internal\n    // method of O with the argument \"length\".\n    // 3. Let len be toUint32(lenValue).\n    var len = O.length >>> 0;\n\n    // 4. If isCallable(callback) is false, throw a TypeError exception. \n    // See: http://es5.github.com/#x9.11\n    if (typeof callback !== \"function\") {\n      throw new TypeError(callback + ' is not a function');\n    }\n\n    // 5. If thisArg was supplied, let T be thisArg; else let\n    // T be undefined.\n    if (arguments.length > 1) {\n      T = thisArg;\n    }\n\n    // 6. Let k be 0\n    k = 0;\n\n    // 7. Repeat, while k < len\n    while (k < len) {\n\n      var kValue;\n\n      // a. Let Pk be ToString(k).\n      //    This is implicit for LHS operands of the in operator\n      // b. Let kPresent be the result of calling the HasProperty\n      //    internal method of O with argument Pk.\n      //    This step can be combined with c\n      // c. If kPresent is true, then\n      if (k in O) {\n\n        // i. Let kValue be the result of calling the Get internal\n        // method of O with argument Pk.\n        kValue = O[k];\n\n        // ii. Call the Call internal method of callback with T as\n        // the this value and argument list containing kValue, k, and O.\n        callback.call(T, kValue, k, O);\n      }\n      // d. Increase k by 1.\n      k++;\n    }\n    // 8. return undefined\n  };\n}\n\n//\n// request\n//\n\nfunction request(options, callback) {\n  // The entry-point to the API: prep the options object and pass the real work to run_xhr.\n  if(typeof callback !== 'function')\n    throw new Error('Bad callback given: ' + callback)\n\n  if(!options)\n    throw new Error('No options given')\n\n  var options_onResponse = options.onResponse; // Save this for later.\n\n  if(typeof options === 'string')\n    options = {'uri':options};\n  else\n    options = JSON.parse(JSON.stringify(options)); // Use a duplicate for mutating.\n\n  options.onResponse = options_onResponse // And put it back.\n\n  if (options.verbose) request.log = getLogger();\n\n  if(options.url) {\n    options.uri = options.url;\n    delete options.url;\n  }\n\n  if(!options.uri && options.uri !== \"\")\n    throw new Error(\"options.uri is a required argument\");\n\n  if(typeof options.uri != \"string\")\n    throw new Error(\"options.uri must be a string\");\n\n  var unsupported_options = ['proxy', '_redirectsFollowed', 'maxRedirects', 'followRedirect']\n  for (var i = 0; i < unsupported_options.length; i++)\n    if(options[ unsupported_options[i] ])\n      throw new Error(\"options.\" + unsupported_options[i] + \" is not supported\")\n\n  options.callback = callback\n  options.method = options.method || 'GET';\n  options.headers = options.headers || {};\n  options.body    = options.body || null\n  options.timeout = options.timeout || request.DEFAULT_TIMEOUT\n\n  if(options.headers.host)\n    throw new Error(\"Options.headers.host is not supported\");\n\n  if(options.json) {\n    options.headers.accept = options.headers.accept || 'application/json'\n    if(options.method !== 'GET')\n      options.headers['content-type'] = 'application/json'\n\n    if(typeof options.json !== 'boolean')\n      options.body = JSON.stringify(options.json)\n    else if(typeof options.body !== 'string' && options.body !== null)\n      options.body = JSON.stringify(options.body)\n  }\n  \n  //BEGIN QS Hack\n  var serialize = function(obj) {\n    var str = [];\n    for(var p in obj)\n      if (obj.hasOwnProperty(p)) {\n        str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\n      }\n    return str.join(\"&\");\n  }\n  \n  if(options.qs){\n    var qs = (typeof options.qs == 'string')? options.qs : serialize(options.qs);\n    if(options.uri.indexOf('?') !== -1){ //no get params\n        options.uri = options.uri+'&'+qs;\n    }else{ //existing get params\n        options.uri = options.uri+'?'+qs;\n    }\n  }\n  //END QS Hack\n  \n  //BEGIN FORM Hack\n  var multipart = function(obj) {\n    //todo: support file type (useful?)\n    var result = {};\n    result.boundry = '-------------------------------'+Math.floor(Math.random()*1000000000);\n    var lines = [];\n    for(var p in obj){\n        if (obj.hasOwnProperty(p)) {\n            lines.push(\n                '--'+result.boundry+\"\\n\"+\n                'Content-Disposition: form-data; name=\"'+p+'\"'+\"\\n\"+\n                \"\\n\"+\n                obj[p]+\"\\n\"\n            );\n        }\n    }\n    lines.push( '--'+result.boundry+'--' );\n    result.body = lines.join('');\n    result.length = result.body.length;\n    result.type = 'multipart/form-data; boundary='+result.boundry;\n    return result;\n  }\n  \n  if(options.form){\n    if(typeof options.form == 'string') throw('form name unsupported');\n    if(options.method === 'POST'){\n        var encoding = (options.encoding || 'application/x-www-form-urlencoded').toLowerCase();\n        options.headers['content-type'] = encoding;\n        switch(encoding){\n            case 'application/x-www-form-urlencoded':\n                options.body = serialize(options.form).replace(/%20/g, \"+\");\n                break;\n            case 'multipart/form-data':\n                var multi = multipart(options.form);\n                //options.headers['content-length'] = multi.length;\n                options.body = multi.body;\n                options.headers['content-type'] = multi.type;\n                break;\n            default : throw new Error('unsupported encoding:'+encoding);\n        }\n    }\n  }\n  //END FORM Hack\n\n  // If onResponse is boolean true, call back immediately when the response is known,\n  // not when the full request is complete.\n  options.onResponse = options.onResponse || noop\n  if(options.onResponse === true) {\n    options.onResponse = callback\n    options.callback = noop\n  }\n\n  // XXX Browsers do not like this.\n  //if(options.body)\n  //  options.headers['content-length'] = options.body.length;\n\n  // HTTP basic authentication\n  if(!options.headers.authorization && options.auth)\n    options.headers.authorization = 'Basic ' + b64_enc(options.auth.username + ':' + options.auth.password);\n\n  return run_xhr(options)\n}\n\nvar req_seq = 0\nfunction run_xhr(options) {\n  var xhr = new XHR\n    , timed_out = false\n    , is_cors = is_crossDomain(options.uri)\n    , supports_cors = ('withCredentials' in xhr)\n\n  req_seq += 1\n  xhr.seq_id = req_seq\n  xhr.id = req_seq + ': ' + options.method + ' ' + options.uri\n  xhr._id = xhr.id // I know I will type \"_id\" from habit all the time.\n\n  if(is_cors && !supports_cors) {\n    var cors_err = new Error('Browser does not support cross-origin request: ' + options.uri)\n    cors_err.cors = 'unsupported'\n    return options.callback(cors_err, xhr)\n  }\n\n  xhr.timeoutTimer = setTimeout(too_late, options.timeout)\n  function too_late() {\n    timed_out = true\n    var er = new Error('ETIMEDOUT')\n    er.code = 'ETIMEDOUT'\n    er.duration = options.timeout\n\n    request.log.error('Timeout', { 'id':xhr._id, 'milliseconds':options.timeout })\n    return options.callback(er, xhr)\n  }\n\n  // Some states can be skipped over, so remember what is still incomplete.\n  var did = {'response':false, 'loading':false, 'end':false}\n\n  xhr.onreadystatechange = on_state_change\n  xhr.open(options.method, options.uri, true) // asynchronous\n  if(is_cors)\n    xhr.withCredentials = !! options.withCredentials\n\n  for (var key in options.headers)\n    xhr.setRequestHeader(key, options.headers[key])\n\n  xhr.send(options.body)\n  return xhr\n\n  function on_state_change(event) {\n    if(timed_out)\n      return request.log.debug('Ignoring timed out state change', {'state':xhr.readyState, 'id':xhr.id})\n\n    request.log.debug('State change', {'state':xhr.readyState, 'id':xhr.id, 'timed_out':timed_out})\n\n    if(xhr.readyState === 1) {\n      request.log.debug('Request started', {'id':xhr.id})\n    }\n\n    else if(xhr.readyState === 2)\n      on_response()\n\n    else if(xhr.readyState === 3) {\n      on_response()\n      on_loading()\n    }\n\n    else if(xhr.readyState === 4) {\n      on_response()\n      on_loading()\n      on_end()\n    }\n  }\n\n  function on_response() {\n    if(did.response)\n      return\n\n    did.response = true\n    request.log.debug('Got response', {'id':xhr.id, 'status':xhr.status})\n    clearTimeout(xhr.timeoutTimer)\n    xhr.statusCode = xhr.status // Node request compatibility\n\n    // Detect failed CORS requests.\n    if(is_cors && xhr.statusCode == 0) {\n      var cors_err = new Error('CORS request rejected: ' + options.uri)\n      cors_err.cors = 'rejected'\n\n      // Do not process this request further.\n      did.loading = true\n      did.end = true\n\n      return options.callback(cors_err, xhr)\n    }\n\n    options.onResponse(null, xhr)\n  }\n\n  function on_loading() {\n    if(did.loading)\n      return\n\n    did.loading = true\n    request.log.debug('Response body loading', {'id':xhr.id})\n    // TODO: Maybe simulate \"data\" events by watching xhr.responseText\n  }\n\n  function on_end() {\n    if(did.end)\n      return\n\n    did.end = true\n    request.log.debug('Request done', {'id':xhr.id})\n\n    xhr.body = xhr.responseText\n    if(options.json) {\n      try        { xhr.body = JSON.parse(xhr.responseText) }\n      catch (er) { return options.callback(er, xhr)        }\n    }\n\n    options.callback(null, xhr, xhr.body)\n  }\n\n} // request\n\nrequest.withCredentials = false;\nrequest.DEFAULT_TIMEOUT = DEFAULT_TIMEOUT;\n\n//\n// defaults\n//\n\nrequest.defaults = function(options, requester) {\n  var def = function (method) {\n    var d = function (params, callback) {\n      if(typeof params === 'string')\n        params = {'uri': params};\n      else {\n        params = JSON.parse(JSON.stringify(params));\n      }\n      for (var i in options) {\n        if (params[i] === undefined) params[i] = options[i]\n      }\n      return method(params, callback)\n    }\n    return d\n  }\n  var de = def(request)\n  de.get = def(request.get)\n  de.post = def(request.post)\n  de.put = def(request.put)\n  de.head = def(request.head)\n  return de\n}\n\n//\n// HTTP method shortcuts\n//\n\nvar shortcuts = [ 'get', 'put', 'post', 'head' ];\nshortcuts.forEach(function(shortcut) {\n  var method = shortcut.toUpperCase();\n  var func   = shortcut.toLowerCase();\n\n  request[func] = function(opts) {\n    if(typeof opts === 'string')\n      opts = {'method':method, 'uri':opts};\n    else {\n      opts = JSON.parse(JSON.stringify(opts));\n      opts.method = method;\n    }\n\n    var args = [opts].concat(Array.prototype.slice.apply(arguments, [1]));\n    return request.apply(this, args);\n  }\n})\n\n//\n// CouchDB shortcut\n//\n\nrequest.couch = function(options, callback) {\n  if(typeof options === 'string')\n    options = {'uri':options}\n\n  // Just use the request API to do JSON.\n  options.json = true\n  if(options.body)\n    options.json = options.body\n  delete options.body\n\n  callback = callback || noop\n\n  var xhr = request(options, couch_handler)\n  return xhr\n\n  function couch_handler(er, resp, body) {\n    if(er)\n      return callback(er, resp, body)\n\n    if((resp.statusCode < 200 || resp.statusCode > 299) && body.error) {\n      // The body is a Couch JSON object indicating the error.\n      er = new Error('CouchDB error: ' + (body.error.reason || body.error.error))\n      for (var key in body)\n        er[key] = body[key]\n      return callback(er, resp, body);\n    }\n\n    return callback(er, resp, body);\n  }\n}\n\n//\n// Utility\n//\n\nfunction noop() {}\n\nfunction getLogger() {\n  var logger = {}\n    , levels = ['trace', 'debug', 'info', 'warn', 'error']\n    , level, i\n\n  for(i = 0; i < levels.length; i++) {\n    level = levels[i]\n\n    logger[level] = noop\n    if(typeof console !== 'undefined' && console && console[level])\n      logger[level] = formatted(console, level)\n  }\n\n  return logger\n}\n\nfunction formatted(obj, method) {\n  return formatted_logger\n\n  function formatted_logger(str, context) {\n    if(typeof context === 'object')\n      str += ' ' + JSON.stringify(context)\n\n    return obj[method].call(obj, str)\n  }\n}\n\n// Return whether a URL is a cross-domain request.\nfunction is_crossDomain(url) {\n  // Fix for React Native. CORS does noet exist in that environment\n  if (navigator && navigator.product === 'ReactNative') {\n    return false;\n  }\n\n  var rurl = /^([\\w\\+\\.\\-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+))?)?/\n\n  // jQuery #8138, IE may throw an exception when accessing\n  // a field from window.location if document.domain has been set\n  var ajaxLocation\n  try { ajaxLocation = location.href }\n  catch (e) {\n    // Use the href attribute of an A element since IE will modify it given document.location\n    ajaxLocation = document.createElement( \"a\" );\n    ajaxLocation.href = \"\";\n    ajaxLocation = ajaxLocation.href;\n  }\n\n  var ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || []\n    , parts = rurl.exec(url.toLowerCase() )\n\n  var result = !!(\n    parts &&\n    (  parts[1] != ajaxLocParts[1]\n    || parts[2] != ajaxLocParts[2]\n    || (parts[3] || (parts[1] === \"http:\" ? 80 : 443)) != (ajaxLocParts[3] || (ajaxLocParts[1] === \"http:\" ? 80 : 443))\n    )\n  )\n\n  //console.debug('is_crossDomain('+url+') -> ' + result)\n  return result\n}\n\n// MIT License from http://phpjs.org/functions/base64_encode:358\nfunction b64_enc (data) {\n    // Encodes string using MIME base64 algorithm\n    var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc=\"\", tmp_arr = [];\n\n    if (!data) {\n        return data;\n    }\n\n    // assume utf8 data\n    // data = this.utf8_encode(data+'');\n\n    do { // pack three octets into four hexets\n        o1 = data.charCodeAt(i++);\n        o2 = data.charCodeAt(i++);\n        o3 = data.charCodeAt(i++);\n\n        bits = o1<<16 | o2<<8 | o3;\n\n        h1 = bits>>18 & 0x3f;\n        h2 = bits>>12 & 0x3f;\n        h3 = bits>>6 & 0x3f;\n        h4 = bits & 0x3f;\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = tmp_arr.join('');\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '==';\n        break;\n        case 2:\n            enc = enc.slice(0, -1) + '=';\n        break;\n    }\n\n    return enc;\n}\nmodule.exports = request;\n"]},"metadata":{},"sourceType":"script"}